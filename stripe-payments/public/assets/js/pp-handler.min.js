function updateAllAmounts(){if(calcTotal(),is_full_discount()?submitBtn.innerHTML=vars.str.strGetForFree:submitBtn.innerHTML=vars.payBtnText.replace(/%s/g,formatMoney(vars.data.amount)),1===vars.data.show_your_order){if(jQuery("#order-total").html(formatMoney(vars.data.amount)),jQuery("#order-item-price").html(formatMoney(vars.data.item_price*vars.data.quantity)),jQuery("#order-quantity").html(vars.data.quantity),jQuery("#order-tax").html(formatMoney(vars.data.taxAmount*vars.data.quantity)),jQuery("#shipping").html(formatMoney(vars.data.shipping)),vars.data.coupon){if(0===jQuery("tr#order-coupon-line").length){var t='<tr id="order-coupon-line"><td>Coupon "'+vars.data.coupon.code+'"</td><td>- <span id="order-coupon"></span></td></tr>';0!==jQuery("tr.variation-line").last().length?jQuery("tr.variation-line").last().after(t):jQuery("tr#order-item-line").after(t)}jQuery("#order-coupon").html(formatMoney(vars.data.coupon.discount_amount*vars.data.quantity))}if(vars.data.variations.applied)for(grpId=0;grpId<vars.data.variations.applied.length;++grpId)0===jQuery("#order-variation-"+grpId+"-line").length&&jQuery("tr#order-item-line").after('<tr id="order-variation-'+grpId+'-line" class="variation-line"><td class="variation-name"></td><td class="variation-price"></td></tr>'),jQuery("#order-variation-"+grpId+"-line").find(".variation-name").html(vars.data.variations.groups[grpId]+"<br>"+vars.data.variations.names[grpId][vars.data.variations.applied[grpId]]),jQuery("#order-variation-"+grpId+"-line").find(".variation-price").html(formatMoney(amount_to_cents(vars.data.variations.prices[grpId][vars.data.variations.applied[grpId]],vars.data.currency)*vars.data.quantity))}doAddonAction("allAmountsUpdated")}function calcTotal(){var t,e,a=vars.data.item_price,r=0;if(vars.data.items)for(e=0;e<vars.data.items.length;++e)a+=amount_to_cents(vars.data.items[e].price,vars.data.currency);if(vars.data.variations.applied)for(t=0;t<vars.data.variations.applied.length;++t)a+=amount_to_cents(vars.data.variations.prices[t][vars.data.variations.applied[t]],vars.data.currency);if(vars.data.coupon){var n=0;n="perc"===vars.data.coupon.discount_type?PHP_round(a*(vars.data.coupon.discount/100),0):is_zero_cents(vars.data.currency)?vars.data.coupon.discount:100*vars.data.coupon.discount,a-=n,vars.data.coupon.discount_amount=n,is_full_discount()&&vars.data.shipping&&(vars.data.shipping_orig=vars.data.shipping,vars.data.shipping=0)}if(vars.data.tax){var o=PHP_round(a*vars.data.tax/100,0);vars.data.taxAmount=o,a+=o}r=a*vars.data.quantity,vars.data.shipping&&(r+=vars.data.shipping),vars.data.amount=PHP_round(r,0)}function PHP_round(t,e){var a=t>=0?1:-1;return parseFloat((Math.round(t*Math.pow(10,e)+1e-4*a)/Math.pow(10,e)).toFixed(e))}function is_zero_cents(t){return-1!==vars.zeroCents.indexOf(t.toUpperCase())}function cents_to_amount(t,e){return is_zero_cents(e)||(t/=100),t}function amount_to_cents(t,e){return t=parseFloat(t),is_zero_cents(e)||(t*=100),t}function showFormInputErr(t,e,a){e.innerHTML=t,jQuery(e).show().hide().fadeIn(),jQuery(a).focus()}function showPopup(){jQuery("#global-spinner").hide(),jQuery("#Aligner-item").addClass("popup-show").hide().fadeIn()}function smokeScreen(t){display=t?"flex":"none",document.getElementById("smoke-screen").style.display=display}function formatMoney(t){var e=!1;t<0&&(t=0-t,e=!0),t=cents_to_amount(t,vars.data.currency);var a=isNaN(a=Math.abs(vars.currencyFormat.c))?2:vars.currencyFormat.c,r=void 0==r?".":vars.currencyFormat.d,n=void 0==n?",":vars.currencyFormat.t,o=t<0?"-":"",s=String(parseInt(t=Math.abs(Number(t)||0).toFixed(a))),d=(d=s.length)>3?d%3:0,i=o+(d?s.substr(0,d)+n:"")+s.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+n)+(a?r+Math.abs(t-s).toFixed(a).slice(2):"");return i="right"!==vars.currencyFormat.pos?vars.currencyFormat.s+i:i+vars.currencyFormat.s,e?"- "+i:i}function inIframe(){try{return window.self!==window.top}catch(t){return!0}}function is_full_discount(){return!(!vars.data.coupon||"perc"!==vars.data.coupon.discount_type||100!==parseFloat(vars.data.coupon.discount))}function triggerEvent(t,e){var a;"createEvent"in document?(a=document.createEvent("HTMLEvents"),a.initEvent(e,!1,!0),t.dispatchEvent(a)):(a=document.createEventObject(),a.eventType=e,t.fireEvent("on"+a.eventType,a))}function validate_custom_field(){if(!customFieldInput)return!0;if(""!==vars.custom_field_validation_regex)try{var t=new RegExp(vars.data.custom_field_validation_regex)}catch(t){return showFormInputErr(vars.str.strInvalidCFValidationRegex+" "+vars.data.custom_field_validation_regex+"\n"+t,errorCont,customFieldInput),!1}return"text"===customFieldInput.type&&customFieldInput.value&&!t.test(customFieldInput.value)?(showFormInputErr(vars.data.custom_field_validation_err_msg,customFieldErr,customFieldInput),!1):(customFieldErr.style.display="none",!0)}function validate_custom_quantity(){var t,e;vars.data.custom_quantity?(e=quantityErr,t=quantityInput.value):(e=errorCont,t=vars.data.quantity);var a=parseInt(t);return isNaN(a)?(showFormInputErr(vars.str.strEnterQuantity,e,quantityInput),!1):t%1!=0?(showFormInputErr(vars.str.strQuantityIsFloat,e,quantityInput),!1):a<=0?(showFormInputErr(vars.str.strQuantityIsZero,e,quantityInput),!1):!0===vars.data.stock_control_enabled&&a>vars.data.stock_items?(showFormInputErr(vars.str.strStockNotAvailable.replace("%d",vars.data.stock_items),e,quantityInput),!1):(e.style.display="none",vars.data.quantity=a,a)}function validate_custom_amount(){var t=amountInput.value;if(0!=vars.amountOpts.applySepOpts?(t=t.replace(vars.amountOpts.thousandSep,""),t=t.replace(vars.amountOpts.decimalSep,".")):(t=t.replace(/\$/g,""),t=t.replace(/,/g,""),t=t.replace(/ /g,"")),t=parseFloat(t),isNaN(t))return showFormInputErr(vars.str.strEnterValidAmount,amountErr,amountInput),!1;var e=t.toFixed(2).toString();if(0!=vars.amountOpts.applySepOpts&&(e=e.replace(".",vars.amountOpts.decimalSep)),is_zero_cents(vars.data.currency)||(t=PHP_round(100*t,0)),void 0!==vars.minAmounts[vars.data.currency]){if(vars.minAmounts[vars.data.currency]>t)return showFormInputErr(vars.str.strMinAmount+" "+cents_to_amount(vars.minAmounts[vars.data.currency],vars.data.currency),amountErr,amountInput),!1}else if(50>t)return showFormInputErr(vars.str.strMinAmount+" 0.5",amountErr,amountInput),!1;return amountErr.style.display="none",amountInput.value=e,t}function canProceed(){if(vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){if(!1===(amount=validate_custom_amount()))return event.preventDefault(),!1;vars.data.item_price=amount}if(vars.data.custom_quantity){if(quantity=validate_custom_quantity(),!1===quantity)return event.preventDefault(),!1;vars.data.quantity=quantity}if(vars.data.custom_field){if(!1===validate_custom_field())return event.preventDefault(),!1}if(""!==piInput.value){if(jQuery("#btn-spinner").hide(),jQuery("#checkmark-cont").css("display","flex"),setTimeout(function(){jQuery("#Aligner-item").fadeOut(function(){smokeScreen(!1),jQuery("#global-spinner").show()})},1500),!inIframe()||window.doSelfSubmit){console.log("Self-submitting");for(var t=0;t<form.elements.length;t++)form.elements[t].name&&form.elements[t].setAttribute("name","asp_"+form.elements[t].name);form.submit()}return!1}if(vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){if(!1===(amount=validate_custom_amount()))return!1;vars.data.item_price=amount}var e=!1;return jQuery("#payment-form").find("[required]:visible").each(function(t,a){if(""===jQuery(a).val()||"checkbox"===jQuery(a).attr("type")&&!jQuery(a).prop("checked"))return jQuery(a).focus(),jQuery(a).one("keyup change",function(){jQuery(this).siblings(".auto-required-err-msg").remove(),jQuery(this).parent().siblings(".auto-required-err-msg").remove()}),e=!0,jQuery("#payment-form").find(".auto-required-err-msg").remove(),"checkbox"===jQuery(a).attr("type")?jQuery(a).parent().after(jQuery('<span class="form-err auto-required-err-msg" role="alert">'+vars.str.strPleaseCheckCheckbox+"</span>").fadeIn()):jQuery(a).after(jQuery('<span class="form-err auto-required-err-msg" role="alert">'+vars.str.strPleaseFillIn+"</span>").fadeIn()),!1}),!e&&(vars.data.tos&&!tosInput.checked?(showFormInputErr(vars.str.strMustAcceptTos,tosInputErr,tosInput),!1):(vars.data.canProceed=!0,doAddonAction("submitCanProceed"),!!vars.data.canProceed))}function handlePayment(){var t=document.getElementById("billing-name"),e=document.getElementById("email"),a={name:t.value,email:e.value};if(vars.data.billing_address){var r=document.getElementById("address"),n=document.getElementById("city"),o=document.getElementById("country"),s=document.getElementById("state"),d=document.getElementById("postcode");a.address={line1:r.value,city:n.value,state:null===s?null:s.value,country:o.value||o.options[o.selectedIndex].value};var i=d.value;i&&(a.address.postal_code=i)}if(vars.data.shipping_address){var u={name:t.value},c=document.getElementById("shipping_address"),l=document.getElementById("shipping_city"),p=document.getElementById("shipping_country"),m=document.getElementById("shipping_state"),v=document.getElementById("shipping_postcode");u.address={line1:c.value,city:l.value,state:null===m?null:m.value,country:p.value||p.options[p.selectedIndex].value};var y=v.value;y&&(u.address.postal_code=y)}vars.data.billing_address&&vars.data.shipping_address&&billshipSwitch.checked&&(u=JSON.parse(JSON.stringify(a)),delete u.email);var f={payment_method:{card:card,billing_details:a}};if(u&&(f.shipping=u),vars.data.billingDetails=a,doAddonAction("csBeforeRegen"),vars.data.doNotProceed)return!1;if(!(is_full_discount()||vars.data.token_not_required||""!==vars.data.client_secret&&vars.data.amount===clientSecAmount&&vars.data.currency===clientSecCurrency)){var _="action=asp_pp_req_token&amount="+vars.data.amount+"&curr="+vars.data.currency+"&product_id="+vars.data.product_id;return _=_+"&quantity="+vars.data.quantity,vars.data.cust_id&&(_=_+"&cust_id="+vars.data.cust_id),""!==vars.data.client_secret&&(_=_+"&pi="+vars.data.pi_id),_=_+"&billing_details="+JSON.stringify(a),u&&(_=_+"&shipping_details="+JSON.stringify(u)),vars.data.csRegenParams=_,doAddonAction("csBeforeRegenParams"),console.log("Regen CS"),new ajaxRequest(vars.ajaxURL,vars.data.csRegenParams,function(t){try{var e=JSON.parse(t.responseText);return console.log(e),(void 0!==e.stock_items&&vars.data.stock_items!==e.stock_items&&(vars.data.stock_items=e.stock_items,validate_custom_quantity()),e.success)?(vars.data.client_secret=e.clientSecret,vars.data.pi_id=e.pi_id,vars.data.cust_id=e.cust_id,clientSecAmount=vars.data.amount,clientSecCurrency=vars.data.currency,doAddonAction("csRegenCompleted"),!vars.data.doNotProceed&&(handlePayment(),!0)):(submitBtn.disabled=!1,errorCont.innerHTML=e.err,errorCont.style.display="block",smokeScreen(!1),!1)}catch(t){console.log(t),alert("Caught Exception: "+t)}},function(t,e){submitBtn.disabled=!1,errorCont.innerHTML=e,errorCont.style.display="block",smokeScreen(!1)}),!1}if(doAddonAction("csReady"),vars.data.doNotProceed)return!1;if(!is_full_discount()&&vars.data.create_token){console.log("Creating token"),f={name:t.value},vars.data.billing_address&&(f.address_line1=r.value,f.address_city=n.value,f.address_state=null===s?"":s.value,f.address_country=o.value||o.options[o.selectedIndex].value,i&&(f.address_zip=i));var g="&product_id="+vars.data.product_id;return vars.data.cust_id&&(g=g+"&cust_id="+vars.data.cust_id),(vars.data.currency_variable&&(g=g+"&currency="+vars.data.currency),vars.data.amount_variable&&"1"!==vars.data.hide_amount_input&&(g=g+"&amount="+vars.data.item_price),vars.data.quantity>1&&(g=g+"&quantity="+vars.data.quantity),vars.data.coupon&&(g=g+"&coupon="+vars.data.coupon.code),g=g+"&billing_details="+JSON.stringify(a),u&&(g=g+"&shipping_details="+JSON.stringify(u)),vars.confirmToken_reqStr=g,doAddonAction("preConfirmToken"),g=vars.confirmToken_reqStr,vars.data.pm_id)?(g="action=asp_pp_confirm_token&asp_pm_id="+vars.data.pm_id+g,confirmToken(g),!0):(stripe.createToken(card,f).then(function(t){console.log(t),t.error?(submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)):(_="action=asp_pp_confirm_token&asp_token_id="+t.token.id+_,confirmToken(_))}),!1)}return!!vars.data.no_action_required||(is_full_discount()?(handleCardPaymentResult({paymentIntent:{id:vars.data.coupon.zero_value_id}}),!1):void(vars.data.do_card_setup?(f.shipping&&(f.shipping=void 0),console.log("Doing confirmCardSetup()"),stripe.confirmCardSetup(vars.data.client_secret,f).then(function(t){console.log(t),t.error?(submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)):(piInput.value=document.getElementById("sub_id").value,!vars.data.coupon&&couponInput&&(couponInput.value=""),triggerEvent(form,"submit"))})):(vars.data.dont_save_card||vars.data.dont_setup_future_usage||(f.save_payment_method=!0,f.setup_future_usage="off_session"),vars.data.stripe_receipt_email&&(f.receipt_email=e.value),vars.confirmCardPayment={},vars.confirmCardPayment.opts=f,doAddonAction("confirmCardPaymentOpts"),console.log("Doing confirmCardPayment()"),stripe.confirmCardPayment(vars.data.client_secret,vars.confirmCardPayment.opts).then(function(t){console.log(t),handleCardPaymentResult(t)}))))}function handleCardPaymentResult(t){t.error?(submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)):(piInput.value=t.paymentIntent.id,!vars.data.coupon&&couponInput&&(couponInput.value=""),triggerEvent(form,"submit"))}function confirmToken(t){console.log("Doing action asp_pp_confirm_token"),new ajaxRequest(vars.ajaxURL,t,function(t){try{var e=JSON.parse(t.responseText);if(console.log(e),!e.success)return submitBtn.disabled=!1,errorCont.innerHTML=e.err,errorCont.style.display="block",smokeScreen(!1),!1;document.getElementById("sub_id").value=e.sub_id,e.cust_id&&(vars.data.cust_id=e.cust_id),e.pi_cs?(vars.data.client_secret=e.pi_cs,vars.data.create_token=!1,e.do_card_setup&&(vars.data.do_card_setup=!0),handlePayment()):(piInput.value=e.pi_id,e.no_action_required&&(vars.data.no_action_required=!0),!vars.data.coupon&&couponInput&&(couponInput.value=""),vars.data.pi_id=e.pi_id,submitForm())}catch(t){console.log(t),alert("Caught Exception: "+t)}},function(t,e){submitBtn.disabled=!1,errorCont.innerHTML=e,errorCont.style.display="block",smokeScreen(!1)})}function submitForm(){triggerEvent(form,"submit")}function doAddonAction(t){vars.data.doNotProceed=!1,vars.data.addons&&vars.data.addons.forEach(function(e){void 0===e.obj&&void 0!==window[e.handler]&&(e.obj=new window[e.handler](vars.data)),void 0!==e.obj&&"function"==typeof e.obj[t]&&(console.log(e.name+": "+t),e.obj[t]())})}function toggleRequiredElements(t,e){t.forEach(function(t){e?jQuery("#"+t).hide():jQuery("#"+t).show()}),e?jQuery("#payment-form").find("[required]").not(":visible").each(function(t,e){jQuery(e).prop("required",!1),jQuery(e).attr("data-required-hidden",1)}):jQuery("#payment-form").find('[data-required-hidden="1"]').each(function(t,e){jQuery(e).prop("required",!0),jQuery(e).attr("data-required-hidden",0)})}function saveFormData(t,e){var a="action=asp_pp_save_form_data&form_data="+encodeURIComponent(jQuery(form).serialize());new ajaxRequest(vars.ajaxURL,a,t,e)}var errorCont=document.getElementById("global-error");if(vars.fatal_error)throw showPopup(),new Error(vars.fatal_error);try{var stripe=Stripe(vars.stripe_key),elements=stripe.elements({locale:vars.data.checkout_lang})}catch(t){throw showPopup(),errorCont.innerHTML=t,errorCont.style.display="block",jQuery("#payment-form").hide(),new Error(t)}if(vars.data.temp=[],vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){var amountInput=document.getElementById("amount"),amountErr=document.getElementById("amount-error");amountInput.addEventListener("change",function(){!1!==(amount=validate_custom_amount())&&(vars.data.item_price=amount,updateAllAmounts())})}if(vars.data.custom_quantity){var quantityInput=document.getElementById("quantity"),quantityErr=document.getElementById("quantity-error");quantityInput.addEventListener("change",function(){quantity=validate_custom_quantity(),!1!==quantity&&(vars.data.quantity=quantity,updateAllAmounts())})}if(vars.data.currency_variable){var currencyInput=document.getElementById("currency");currencyInput.addEventListener("change",function(){vars.data.currency=currencyInput.value||currencyInput.options[currencyInput.selectedIndex],vars.currencyFormat.s=currencyInput.options[currencyInput.selectedIndex].getAttribute("data-asp-curr-sym"),updateAllAmounts()})}if(vars.data.custom_field){var customFieldInput=document.getElementById("asp-custom-field"),customFieldErr=document.getElementById("custom-field-error");customFieldInput&&customFieldInput.addEventListener("change",function(){validate_custom_field()})}if(vars.data.coupons_enabled){var couponBtn=document.getElementById("apply-coupon-btn"),couponRemoveBtn=document.getElementById("remove-coupon-btn"),couponResCont=document.getElementById("coupon-res-cont"),couponInputCont=document.getElementById("coupon-input-cont"),couponInput=document.getElementById("coupon-code"),couponErr=document.getElementById("coupon-err"),couponInfo=document.getElementById("coupon-info");couponInput.addEventListener("keydown",function(t){if(13===t.keyCode)return t.preventDefault(),couponBtn.click(),!1}),couponBtn.addEventListener("click",function(t){if(t.preventDefault(),couponErr.style.display="none",""===couponInput.value)return!1;couponBtn.disabled=!0,smokeScreen(!0);var e="action=asp_pp_check_coupon&product_id="+vars.data.product_id+"&coupon_code="+couponInput.value;new ajaxRequest(vars.ajaxURL,e,function(t){console.log(t);var e=JSON.parse(t.responseText);e.err?(delete vars.data.coupon,console.log(e.err),showFormInputErr(e.err,couponErr,couponInput)):(vars.data.coupon=e,console.log(vars.data.coupon),calcTotal(),couponInfo.innerHTML=vars.data.coupon.code+":  - ","perc"===vars.data.coupon.discount_type?couponInfo.innerHTML=couponInfo.innerHTML+vars.data.coupon.discount+"%":couponInfo.innerHTML=couponInfo.innerHTML+formatMoney(vars.data.coupon.discount_amount),couponResCont.style.display="block",couponInputCont.style.display="none",is_full_discount()&&(jQuery('[data-pm-id="def"]').click(),jQuery("#pm-select-cont").hide(),jQuery("#card-cont").hide())),updateAllAmounts(),couponBtn.disabled=!1,smokeScreen(!1)},function(t,e){errorCont.innerHTML=e,errorCont.style.display="block",couponBtn.disabled=!1,smokeScreen(!1)})}),couponRemoveBtn.addEventListener("click",function(){is_full_discount()&&(jQuery("#pm-select-cont").show(),jQuery("#card-cont").show(),vars.data.shipping_orig&&(vars.data.shipping=vars.data.shipping_orig)),delete vars.data.coupon,jQuery("#order-coupon-line").remove(),couponInput.value="",couponResCont.style.display="none",couponInputCont.style.display="block",updateAllAmounts()})}var amount=vars.data.amount,clientSecAmount=0,clientSecCurrency="",style={base:{fontSize:"16px"}},submitBtn=document.getElementById("submit-btn"),piInput=document.getElementById("payment-intent"),cardErrorCont=document.getElementById("card-errors"),form=document.getElementById("payment-form");if(vars.data.tos){var tosInput=document.getElementById("tos"),tosInputErr=document.getElementById("tos-error");tosInput.addEventListener("change",function(){tosInputErr.style.display="none"})}if(!jQuery.isEmptyObject(vars.data.variations)){var varInputs=document.getElementsByClassName("variations-input");vars.data.temp.prePopupDisplayVariationsUpdate=!0;for(var i=0;i<varInputs.length;i++)!function(t){varInputs[t].addEventListener("change",function(){var t=this.getAttribute("data-asp-variations-group-id"),e=this.value;0!==Object.getOwnPropertyNames(vars.data.variations).length&&(vars.data.variations.applied||(vars.data.variations.applied=[]),vars.data.variations.applied[t]=e,vars.data.temp.prePopupDisplayVariationsUpdate||updateAllAmounts())}),(varInputs[t].checked||"SELECT"===varInputs[t].tagName)&&triggerEvent(varInputs[t],"change")}(i);vars.data.temp.prePopupDisplayVariationsUpdate=!1,updateAllAmounts()}if(vars.data.billing_address&&vars.data.shipping_address){for(var billshipSwitch=document.getElementById("same-bill-ship-addr"),billaddrCont=document.getElementById("billing-addr-cont"),shipaddrCont=document.getElementById("shipping-addr-cont"),baddrToggles=document.getElementsByClassName("baddr-toggle"),baddrHide=document.getElementsByClassName("baddr-hide"),saddrRequired=document.getElementsByClassName("saddr-required"),itemsArr=[],i=0;i<baddrToggles.length;i++)!function(t){itemsArr.push(baddrToggles[t])}(i);billshipSwitch.addEventListener("change",function(){var t;if(billshipSwitch.checked){for(t=0;t<itemsArr.length;t++)!function(t){attr=itemsArr[t].getAttribute("data-class-save"),itemsArr[t].className=attr}(t);for(t=0;t<baddrHide.length;t++)!function(t){baddrHide[t].style.display="inline-block"}(t);for(t=0;t<saddrRequired.length;t++)!function(t){saddrRequired[t].required=!1}(t);billaddrCont.className="",shipaddrCont.style.display="none"}else{for(t=0;t<itemsArr.length;t++)!function(t){itemsArr[t].setAttribute("data-class-save",itemsArr[t].className),itemsArr[t].className="pure-u-1"}(t);for(t=0;t<baddrHide.length;t++)!function(t){baddrHide[t].style.display="none"}(t);for(t=0;t<saddrRequired.length;t++)!function(t){saddrRequired[t].required=!0}(t);billaddrCont.className="half-width",shipaddrCont.style.display="inline-block"}})}var card=elements.create("card",{style:style,hidePostalCode:!(vars.data.verify_zip&&!vars.data.billing_address)});card.on("ready",function(){submitBtn.disabled=!1}),card.mount("#card-element"),card.addEventListener("change",function(t){errorCont.style.display="none",t.error?cardErrorCont.textContent=t.error.message:cardErrorCont.textContent="",vars.data.cardComplete=t.complete}),submitBtn.addEventListener("click",function(){vars.data.isEvent||(vars.data.buttonClicked="")}),form.addEventListener("submit",function(t){return t.preventDefault(),!!canProceed()&&(is_full_discount()||"def"!==vars.data.currentPM&&vars.data.currentPM||vars.data.cardComplete?(errorCont.style.display="none",submitBtn.disabled=!0,updateAllAmounts(),smokeScreen(!0),doAddonAction("readyToProceed"),void handlePayment()):(t.preventDefault(),card.focus(),!1))}),vars.data.initShowPopup=!0,vars.data.currentPM="def",doAddonAction("init"),jQuery("select#currency").on("change",function(){if(!vars.data.addons||!vars.data.currentPM)return!0;vars.data.addons.forEach(function(t){t.supported_curr&&(t.supported_curr.includes(jQuery("select#currency").val())?(jQuery('input[data-pm-id="'+t.name+'"]').attr("disabled",!1).parent().removeClass("pm-disabled"),vars.data.currentPM===t.name&&(submitBtn.disabled=!1,errorCont.style.display="none")):(jQuery('input[data-pm-id="'+t.name+'"]').attr("disabled",!0).parent().addClass("pm-disabled").css("position","relative"),vars.data.currentPM===t.name&&(submitBtn.disabled=!0,errorCont.innerHTML=vars.str.strCurrencyNotSupported,errorCont.style.display="block")))})}),jQuery("select#currency").change(),vars.data.initShowPopup&&showPopup(),jQuery(".pm-select-btn").click(function(){vars.data.currentPM=jQuery(this).data("pm-id"),jQuery(".pm-select-btn").parent().removeClass("pure-menu-selected"),jQuery(this).parent().addClass("pure-menu-selected"),vars.data.dont_hide_button=!1,doAddonAction("pmSelectClicked");var t=jQuery("#payment-form").find('[data-pm-name][data-pm-name!="'+vars.data.currentPM+'"]');vars.data.dont_hide_button&&(jQuery("#submit-btn-cont").show(),t=jQuery(t.not("#submit-btn-cont"))),t.hide(),jQuery("#payment-form").find('[data-pm-name="'+vars.data.currentPM+'"]').show()});var ajaxRequest=function(t,e,a,r){var n=this;if(this.URL=t,this.reqStr=e,this.doneFunc=a,this.failFunc=r,this.XMLHttpReq=new XMLHttpRequest,!this.XMLHttpReq)return alert("Cannot create an XMLHTTP instance"),!1;n.XMLHttpReq.onreadystatechange=function(){if(n.XMLHttpReq.readyState===XMLHttpRequest.DONE)if(200===n.XMLHttpReq.status)n.doneFunc(n.XMLHttpReq);else{console.log("ajaxRequest failed"),console.log(n.XMLHttpReq);var t="Error occurred: "+n.XMLHttpReq.statusText+"\n";t+="URL: "+n.XMLHttpReq.responseURL+"\n",t+="Code: "+n.XMLHttpReq.status,n.failFunc&&n.failFunc(n.XMLHttpReq,t)}},n.XMLHttpReq.open("POST",n.URL),n.XMLHttpReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.XMLHttpReq.send(e)};