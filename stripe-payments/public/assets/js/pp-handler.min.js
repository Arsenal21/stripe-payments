function updateAllAmounts(){if(calcTotal(),is_full_discount()?submitBtn.innerHTML=vars.str.strGetForFree:vars.data.is_trial&&vars.data.amount_variable||(submitBtn.innerHTML=vars.payBtnText.replace(/%s/g,formatMoney(vars.data.amount))),1===vars.data.show_your_order){var t=vars.data.amount<0?0:vars.data.amount;if(jQuery("#order-total").html(formatMoney(t)),jQuery("#order-item-price").html(formatMoney(vars.data.item_price*vars.data.quantity)),jQuery("#order-quantity").html(vars.data.quantity),jQuery("#order-tax").html(formatMoney(vars.data.taxAmount)),jQuery("#order-tax-perc").html(vars.data.tax),vars.data.tax>0&&jQuery("#order-tax-line").show(),jQuery("#shipping").html(formatMoney(vars.data.shipping)),vars.data.coupon&&!vars.data.is_trial){if(0===jQuery("tr#order-coupon-line").length){var e='<tr id="order-coupon-line"><td>'+vars.str.strCoupon+' "'+vars.data.coupon.code+'"</td><td>- <span id="order-coupon"></span></td></tr>';0!==jQuery("tr.variation-line").last().length?jQuery("tr.variation-line").last().after(e):jQuery("tr#order-item-line").after(e)}var a=vars.data.coupon.discount_amount;vars.data.coupon.discount_amount>vars.data.coupon.amount_before_discount&&(a=vars.data.coupon.amount_before_discount),jQuery("#order-coupon").html(formatMoney(a))}if(vars.data.variations.applied)for(grpId=0;grpId<vars.data.variations.applied.length;++grpId)if(vars.data.variations.groups[grpId]){0===jQuery("#order-variation-"+grpId+"-line").length&&jQuery("tr#order-item-line").after('<tr id="order-variation-'+grpId+'-line" class="variation-line"><td class="variation-name"></td><td class="variation-price"></td></tr>');var r="",n="";if(vars.data.variations.applied[grpId]instanceof Array)for(varId=0;varId<vars.data.variations.applied[grpId].length;varId++)vars.data.variations.applied[grpId][varId]&&(r+=vars.data.variations.names[grpId][varId]+"<br />",n+=formatMoney(amount_to_cents(vars.data.variations.prices[grpId][varId],vars.data.currency)*vars.data.quantity)+"<br />");else r=vars.data.variations.names[grpId][vars.data.variations.applied[grpId]],n=formatMoney(amount_to_cents(vars.data.variations.prices[grpId][vars.data.variations.applied[grpId]],vars.data.currency)*vars.data.quantity);r||n?(r=vars.data.variations.groups[grpId]+"<br />"+r,n="<br />"+n,jQuery("#order-variation-"+grpId+"-line").find(".variation-name").html(r),jQuery("#order-variation-"+grpId+"-line").find(".variation-price").html(n)):jQuery("tr#order-variation-"+grpId+"-line").remove()}}doAddonAction("allAmountsUpdated")}function calcTotal(){var t,e,a=vars.data.item_price,r=0;if(vars.data.items)for(e=0;e<vars.data.items.length;++e)a+=amount_to_cents(vars.data.items[e].price,vars.data.currency);if(vars.data.variations.applied)for(t=0;t<vars.data.variations.applied.length;++t){var n=0;if(vars.data.variations.prices[t]&&void 0!==vars.data.variations.applied[t]){if(vars.data.variations.applied[t]instanceof Array)for(varId=0;varId<vars.data.variations.applied[t].length;varId++)vars.data.variations.applied[t][varId]&&(n+=parseFloat(vars.data.variations.prices[t][varId]));else n=vars.data.variations.prices[t][vars.data.variations.applied[t]];a+=amount_to_cents(n,vars.data.currency)}}if(a*=vars.data.quantity,vars.data.coupon&&!vars.data.is_trial){var o=0;"perc"===vars.data.coupon.discount_type?o=PHP_round(a*(vars.data.coupon.discount/100),0):(o=1===vars.data.coupon.per_order?vars.data.coupon.discount:vars.data.coupon.discount*vars.data.quantity,is_zero_cents(vars.data.currency)||(o*=100)),vars.data.coupon.amount_before_discount=a,a-=o,vars.data.coupon.discount_amount=o,is_full_discount()&&vars.data.shipping&&(vars.data.shipping_orig=vars.data.shipping,vars.data.shipping=0)}if(vars.data.tax){var s=PHP_round(a*vars.data.tax/100,0);vars.data.taxAmount=s,a+=s}r=a,vars.data.shipping&&(r+=vars.data.shipping),vars.data.amount=PHP_round(r,0)}function PHP_round(t,e){var a=t>=0?1:-1;return parseFloat((Math.round(t*Math.pow(10,e)+1e-4*a)/Math.pow(10,e)).toFixed(e))}function is_zero_cents(t){return-1!==vars.zeroCents.indexOf(t.toUpperCase())}function cents_to_amount(t,e){return t=is_zero_cents(e)?PHP_round(t,0):PHP_round(t/100,2)}function amount_to_cents(t,e){return t=parseFloat(t),is_zero_cents(e)||(t*=100),PHP_round(t,0)}function showFormInputErr(t,e,a){e.innerHTML=t,jQuery(e).show().hide().fadeIn(),jQuery(a).focus()}function showPopup(){"undefined"!=typeof jQuery?(jQuery("#global-spinner").hide(),jQuery("#Aligner-item").addClass("popup-show").hide().fadeIn()):(document.getElementById("global-spinner").style.display="none",document.getElementById("Aligner-item").classList.add("popup-show"))}function smokeScreen(t){display=t?"flex":"none",document.getElementById("smoke-screen").style.display=display}function formatMoney(t){var e=!1;t<0&&(t=0-t,e=!0),t=cents_to_amount(t,vars.data.currency);var a=isNaN(a=Math.abs(vars.currencyFormat.c))?2:vars.currencyFormat.c,r=vars.currencyFormat.d,n=vars.currencyFormat.t,o=t<0?"-":"",s=String(parseInt(t=Math.abs(Number(t)||0).toFixed(a))),i=(i=s.length)>3?i%3:0,d=o+(i?s.substr(0,i)+n:"")+s.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+n)+(a?r+Math.abs(t-s).toFixed(a).slice(2):"");return d="right"!==vars.currencyFormat.pos?vars.currencyFormat.s+d:d+vars.currencyFormat.s,e?"- "+d:d}function inIframe(){try{return window.self!==window.top}catch(t){return!0}}function is_full_discount(){return!(!vars.data.coupon||!("perc"===vars.data.coupon.discount_type&&100===parseFloat(vars.data.coupon.discount)||vars.data.coupon.discount_amount>=vars.data.coupon.amount_before_discount))}function triggerEvent(t,e){var a;"createEvent"in document?(a=new Event(e,{bubbles:!0,cancelable:!0}),t.dispatchEvent(a)):(a=document.createEventObject(),a.eventType=e,t.fireEvent("on"+a.eventType,a))}function validate_custom_field(){if(!customFieldInput)return!0;if(""!==vars.custom_field_validation_regex)try{var t=new RegExp(vars.data.custom_field_validation_regex)}catch(t){return showFormInputErr(vars.str.strInvalidCFValidationRegex+" "+vars.data.custom_field_validation_regex+"\n"+t,errorCont,customFieldInput),!1}return"text"===customFieldInput.type&&customFieldInput.value&&!t.test(customFieldInput.value)?(showFormInputErr(vars.data.custom_field_validation_err_msg,customFieldErr,customFieldInput),!1):(customFieldErr.style.display="none",!0)}function validate_custom_quantity(){var t,e;vars.data.custom_quantity?(e=quantityErr,t=quantityInput.value):(e=errorCont,t=vars.data.quantity);var a=parseInt(t);return isNaN(a)?(showFormInputErr(vars.str.strEnterQuantity,e,quantityInput),!1):t%1!=0?(showFormInputErr(vars.str.strQuantityIsFloat,e,quantityInput),!1):a<=0?(showFormInputErr(vars.str.strQuantityIsZero,e,quantityInput),!1):!0===vars.data.stock_control_enabled&&a>vars.data.stock_items?(showFormInputErr(vars.str.strStockNotAvailable.replace("%d",vars.data.stock_items),e,quantityInput),!1):(e.style.display="none",vars.data.quantity=a,a)}function validate_custom_amount(){var t=amountInput.value;if(0!=vars.amountOpts.applySepOpts?(t=t.replace(vars.amountOpts.thousandSep,""),t=t.replace(vars.amountOpts.decimalSep,".")):(t=t.replace(/\$/g,""),t=t.replace(/,/g,""),t=t.replace(/ /g,"")),t=parseFloat(t),isNaN(t))return showFormInputErr(vars.str.strEnterValidAmount,amountErr,amountInput),!1;var e=t.toFixed(2).toString();if(0!=vars.amountOpts.applySepOpts&&(e=e.replace(".",vars.amountOpts.decimalSep)),is_zero_cents(vars.data.currency)||(t=PHP_round(100*t,0)),0!==vars.data.min_amount&&vars.data.min_amount>t)return showFormInputErr(vars.str.strMinAmount+" "+formatMoney(vars.data.min_amount),amountErr,amountInput),!1;if(void 0!==vars.minAmounts[vars.data.currency]){if(vars.minAmounts[vars.data.currency]>t)return showFormInputErr(vars.str.strMinAmount+" "+formatMoney(vars.minAmounts[vars.data.currency]),amountErr,amountInput),!1}else if(50>t)return showFormInputErr(vars.str.strMinAmount+" "+formatMoney(50),amountErr,amountInput),!1;return amountErr.style.display="none",amountInput.value=e,t}function canProceed(){if(vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){if(!1===(amount=validate_custom_amount()))return!1;vars.data.item_price=amount}if(vars.data.custom_quantity){if(quantity=validate_custom_quantity(),!1===quantity)return!1;vars.data.quantity=quantity}if(vars.data.custom_field){if(!1===validate_custom_field())return!1}if(""!==piInput.value){jQuery("#btn-spinner").hide(),jQuery("#checkmark-cont").css("display","flex");var t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(setTimeout(function(){jQuery("#Aligner-item").fadeOut(function(){smokeScreen(!1),jQuery("#global-spinner").show(),t&&form.submit()})},1500),!inIframe()||window.doSelfSubmit){console.log("Self-submitting");for(var e=0;e<form.elements.length;e++)form.elements[e].name&&form.elements[e].setAttribute("name","asp_"+form.elements[e].name);t||form.submit()}return!1}if(vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){if(!1===(amount=validate_custom_amount()))return!1;vars.data.item_price=amount}var a=!1;return jQuery("#payment-form").find("[required]:visible").each(function(t,e){if(""===jQuery(e).val()||"checkbox"===jQuery(e).attr("type")&&!jQuery(e).prop("checked"))return jQuery(e).focus(),jQuery(e).one("keyup change",function(){jQuery(this).siblings(".auto-required-err-msg").remove(),jQuery(this).parent().siblings(".auto-required-err-msg").remove()}),a=!0,jQuery("#payment-form").find(".auto-required-err-msg").remove(),"checkbox"===jQuery(e).attr("type")?jQuery(e).parent().after(jQuery('<span class="form-err auto-required-err-msg" role="alert">'+vars.str.strPleaseCheckCheckbox+"</span>").fadeIn()):jQuery(e).after(jQuery('<span class="form-err auto-required-err-msg" role="alert">'+vars.str.strPleaseFillIn+"</span>").fadeIn()),!1}),!a&&(vars.data.tos&&!tosInput.checked?(showFormInputErr(vars.str.strMustAcceptTos,tosInputErr,tosInput),!1):(vars.data.canProceed=!0,doAddonAction("submitCanProceed"),!!vars.data.canProceed))}function handlePayment(){function t(){delete h.payment_method,vars.data.pm_confirmed?(delete h.save_payment_method,delete h.setup_future_usage):(h.payment_method_data={type:"card"},h.payment_method_data.card={token:vars.data.token_id},vars.data.dont_save_card&&(h.payment_method_data.billing_details={name:e.value,email:encodeURIComponent(a.value)})),vars.confirmCardPayment={},vars.confirmCardPayment.opts=h,doAddonAction("confirmCardPaymentOpts"),console.log("Doing asp_pp_confirm_pi"),h=vars.confirmCardPayment.opts,new ajaxRequest(vars.ajaxURL,"action=asp_pp_confirm_pi&product_id="+vars.data.product_id+"&pi_id="+vars.data.pi_id+"&token="+vars.data.visitor_token+"&opts="+JSON.stringify(h),function(t){console.log(t);var e=JSON.parse(t.response);return e.err?(vars.data.token_id=null,vars.data.pm_id=null,vars.data.pm_confirmed=!1,submitBtn.disabled=!1,errorCont.innerHTML=e.err,errorCont.style.display="block",smokeScreen(!1),!1):e.redirect_to?void(e.use_iframe?(console.log("3D Secure init"),jQuery("#btn-spinner").hide(),jQuery("#redirect-spinner").fadeIn(),jQuery("#asp-3ds-popup").remove(),jQuery("#Aligner").append('<iframe id="asp-3ds-popup" frameborder="0" src="'+e.redirect_to+'"></iframe>'),jQuery("#asp-3ds-popup").on("load",function(){jQuery(this).fadeIn(),jQuery("#threeds-iframe-close-btn").show(),jQuery(this).off("load")})):(console.log("3D Secure redirect"),saveFormData(function(){jQuery("#btn-spinner").hide(),jQuery("#redirect-spinner").fadeIn(),!inIframe||window.doSelfSubmit?window.location.href=e.redirect_to:window.top.location.href=e.redirect_to},null))):(piInput.value=vars.data.pi_id,!vars.data.coupon&&couponInput&&(couponInput.value=""),void triggerEvent(form,"submit"))},function(t,e){submitBtn.disabled=!1,errorCont.innerHTML=e,errorCont.style.display="block",smokeScreen(!1)})}var e=document.getElementById("billing-name"),a=document.getElementById("email"),r={name:e.value,email:encodeURIComponent(a.value)};if(vars.data.billing_address){var n=document.getElementById("address"),o=document.getElementById("city"),s=document.getElementById("country"),i=document.getElementById("state"),d=document.getElementById("postcode");r.address={line1:n.value,city:o.value,state:null===i?null:i.value,country:s.value||s.options[s.selectedIndex].value};var u=d.value;u&&(r.address.postal_code=u)}if(vars.data.shipping_address){var c={name:e.value},l=document.getElementById("shipping_address"),p=document.getElementById("shipping_city"),v=document.getElementById("shipping_country"),m=document.getElementById("shipping_state"),y=document.getElementById("shipping_postcode");c.address={line1:l.value,city:p.value,state:null===m?null:m.value,country:v.value||v.options[v.selectedIndex].value};var f=y.value;f&&(c.address.postal_code=f)}vars.data.billing_address&&vars.data.shipping_address&&billshipSwitch.checked&&(c=JSON.parse(JSON.stringify(r)),delete c.email);var h={payment_method:{card:card,billing_details:r}};if(c&&(h.shipping=c),vars.data.billingDetails=r,doAddonAction("csBeforeRegen"),vars.data.doNotProceed)return!1;if(!(is_full_discount()||vars.data.token_not_required||""!==vars.data.client_secret&&vars.data.amount===clientSecAmount&&vars.data.currency===clientSecCurrency)){var _="action=asp_pp_create_pi&amount="+vars.data.amount+"&curr="+vars.data.currency+"&product_id="+vars.data.product_id;return _=_+"&quantity="+vars.data.quantity,vars.data.cust_id&&(_=_+"&cust_id="+vars.data.cust_id),""!==vars.data.client_secret&&(_=_+"&pi="+vars.data.pi_id),_=_+"&billing_details="+JSON.stringify(r),c&&(_=_+"&shipping_details="+JSON.stringify(c)),_+="&token="+vars.data.visitor_token,vars.data.csRegenParams=_,doAddonAction("csBeforeRegenParams"),console.log("Doing asp_pp_create_pi"),new ajaxRequest(vars.ajaxURL,vars.data.csRegenParams,function(t){try{var e=JSON.parse(t.responseText);return console.log(e),(void 0!==e.stock_items&&vars.data.stock_items!==e.stock_items&&(vars.data.stock_items=e.stock_items,validate_custom_quantity()),e.success)?(vars.data.client_secret=e.clientSecret,vars.data.pi_id=e.pi_id,vars.data.cust_id=e.cust_id,clientSecAmount=vars.data.amount,clientSecCurrency=vars.data.currency,doAddonAction("csRegenCompleted"),!vars.data.doNotProceed&&(handlePayment(),!0)):(submitBtn.disabled=!1,errorCont.innerHTML=e.err,errorCont.style.display="block",smokeScreen(!1),!1)}catch(t){console.log(t),alert("Caught Exception: "+t)}},function(t,e){submitBtn.disabled=!1,errorCont.innerHTML=e,errorCont.style.display="block",smokeScreen(!1)}),!1}if(doAddonAction("csReady"),vars.data.doNotProceed)return!1;if(!is_full_discount()&&vars.data.create_token){console.log("Creating token"),h={name:e.value},vars.data.billing_address&&(h.address_line1=n.value,h.address_city=o.value,h.address_state=null===i?"":i.value,h.address_country=s.value||s.options[s.selectedIndex].value,u&&(h.address_zip=u));var g="&product_id="+vars.data.product_id;return vars.data.cust_id&&(g=g+"&cust_id="+vars.data.cust_id),(vars.data.currency_variable&&(g=g+"&currency="+vars.data.currency),vars.data.amount_variable&&"1"!==vars.data.hide_amount_input&&(g=g+"&amount="+vars.data.item_price),vars.data.quantity>1&&(g=g+"&quantity="+vars.data.quantity),vars.data.coupon&&(g=g+"&coupon="+vars.data.coupon.code),g=g+"&billing_details="+JSON.stringify(r),c&&(g=g+"&shipping_details="+JSON.stringify(c)),g+="&token="+vars.data.visitor_token,vars.confirmToken_reqStr=g,doAddonAction("preConfirmToken"),g=vars.confirmToken_reqStr,vars.data.pm_id)?(g="action=asp_pp_confirm_token&asp_pm_id="+vars.data.pm_id+g,confirmToken(g),!0):(stripe.createToken(card,h).then(function(t){console.log(t),t.error?(submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)):(g="action=asp_pp_confirm_token&asp_token_id="+t.token.id+g,vars.data.token_id=t.token.id,confirmToken(g))}),!1)}if(vars.data.no_action_required)return!0;if(is_full_discount())return handleCardPaymentResult({paymentIntent:{id:vars.data.coupon.zero_value_id}}),!1;if(vars.data.do_card_setup)return h.shipping&&(h.shipping=void 0),console.log("Doing confirmCardSetup()"),void stripe.confirmCardSetup(vars.data.client_secret,h).then(function(t){console.log(t),t.error?(submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)):(piInput.value=document.getElementById("sub_id").value,!vars.data.coupon&&couponInput&&(couponInput.value=""),triggerEvent(form,"submit"))});if(vars.data.dont_save_card||vars.data.dont_setup_future_usage||(h.save_payment_method=!0,h.setup_future_usage="off_session"),vars.data.stripe_receipt_email&&(h.receipt_email=encodeURIComponent(a.value)),vars.data.pm_id||vars.data.token_id)return void t();var b={name:e.value};vars.data.billing_address&&(b.address_line1=n.value,b.address_city=o.value,b.address_state=null===i?"":i.value,b.address_country=s.value||s.options[s.selectedIndex].value,u&&(b.address_zip=u)),console.log("Doing createToken()"),stripe.createToken(card,b).then(function(e){if(console.log(e),!e.error)return vars.data.token_id=e.token.id,void t();submitBtn.disabled=!1,errorCont.innerHTML=e.error.message,errorCont.style.display="block",smokeScreen(!1)})}function ThreeDSCompleted(t){console.log("3D Secure completed"),jQuery("#asp-3ds-popup").remove(),jQuery("#threeds-iframe-close-btn").hide(),jQuery("#redirect-spinner").hide(),jQuery("#btn-spinner").fadeIn(),stripe.retrievePaymentIntent(t).then(function(t){console.log(t),t.error||"requires_confirmation"!==t.paymentIntent.status&&"succeeded"!==t.paymentIntent.status?(vars.data.token_id=null,vars.data.pm_id=null,vars.data.pm_confirmed=!1,submitBtn.disabled=!1,errorCont.innerHTML=vars.str.str3DSecureFailed,errorCont.style.display="block",smokeScreen(!1)):(vars.data.pm_confirmed=!0,handlePayment())})}function handleCardPaymentResult(t){if(!t.error)return piInput.value=t.paymentIntent.id,!vars.data.coupon&&couponInput&&(couponInput.value=""),jQuery(form).trigger("submit"),!0;submitBtn.disabled=!1,errorCont.innerHTML=t.error.message,errorCont.style.display="block",smokeScreen(!1)}function confirmToken(t){if(vars.data.confirmTokenStr=t,vars.data.canProceed=!0,console.log("Doing action asp_pp_confirm_token"),doAddonAction("confirmToken"),!vars.data.canProceed)return!1;new ajaxRequest(vars.ajaxURL,t,function(t){try{var e=JSON.parse(t.responseText);if(console.log(e),!e.success)return submitBtn.disabled=!1,errorCont.innerHTML=e.err,errorCont.style.display="block",smokeScreen(!1),!1;document.getElementById("sub_id").value=e.sub_id,e.cust_id&&(vars.data.cust_id=e.cust_id),e.pi_cs?(vars.data.client_secret=e.pi_cs,vars.data.create_token=!1,e.do_card_setup&&(vars.data.do_card_setup=!0),vars.data.pi_id=e.pi_id,vars.data.pm_confirmed=!0,handlePayment()):(piInput.value=e.pi_id,e.no_action_required&&(vars.data.no_action_required=!0),!vars.data.coupon&&couponInput&&(couponInput.value=""),vars.data.pi_id=e.pi_id,submitForm())}catch(t){console.log(t),alert("Caught Exception: "+t)}},function(t,e){submitBtn.disabled=!1,errorCont.innerHTML=e,errorCont.style.display="block",smokeScreen(!1)})}function submitForm(){triggerEvent(form,"submit")}function doAddonAction(t){vars.data.doNotProceed=!1,vars.data.addons&&vars.data.addons.forEach(function(e){void 0===e.obj&&void 0!==window[e.handler]&&(e.obj=new window[e.handler](vars.data)),void 0!==e.obj&&"function"==typeof e.obj[t]&&(console.log(e.name+": "+t),e.obj[t]())})}function toggleRequiredElements(t,e){t.forEach(function(t){e?jQuery("#"+t).hide():jQuery("#"+t).show()}),e?jQuery("#payment-form").find("[required]").not(":visible").each(function(t,e){jQuery(e).prop("required",!1),jQuery(e).attr("data-required-hidden",1)}):jQuery("#payment-form").find('[data-required-hidden="1"]').each(function(t,e){jQuery(e).prop("required",!0),jQuery(e).attr("data-required-hidden",0)})}function saveFormData(t,e){var a="action=asp_pp_save_form_data&form_data="+encodeURIComponent(jQuery(form).serialize());new ajaxRequest(vars.ajaxURL,a,t,e)}function popStateListener(){"function"==typeof parent.WPASPClosePaymentPopup?(window.removeEventListener("popstate",popStateListener),window.history.replaceState(null,"",null),this.closeBtn.focus(),parent.WPASPClosePaymentPopup()):window.history.go(-1)}function popstateAttachEvent(){"function"==typeof history.pushState&&"function"==typeof parent.WPASPClosePaymentPopup&&(window.addEventListener("popstate",popStateListener),window.history.pushState({aspPopup:1},"",null))}function popupDisplayed(){checkAge(),popstateAttachEvent()}function checkAge(){if(void 0===checkAgeInterval&&(checkAgeInterval=setInterval(checkAge,6e4)),vars.data.initTime+3600<Math.floor(initTime/1e3)||initTime+36e5<Date.now())throw smokeScreen(!0),window.location.href=replaceUrlParam(window.location.href,"refresh",initTime),new Error("Page expired")}function replaceUrlParam(t,e,a){null==a&&(a="");var r=new RegExp("\\b("+e+"=).*?(&|#|$)");return t.search(r)>=0?t.replace(r,"$1"+a+"$2"):(t=t.replace(/[?#]$/,""))+(t.indexOf("?")>0?"&":"?")+e+"="+a}var aspTaxVariationsNG=function(t){var e=this;e.init=function(){vars.data.default_tax=vars.data.tax,e.billingSwitch=document.getElementById("same-bill-ship-addr"),e.bCountrySelect=document.getElementById("country"),e.bState=document.getElementById("state"),e.bCity=document.getElementById("city"),e.sCountrySelect=document.getElementById("shipping_country"),e.sState=document.getElementById("shipping_state"),e.sCity=document.getElementById("shipping_city"),e.bCountrySelect&&e.bCountrySelect.addEventListener("change",function(){"0"!==this.value&&(doAddonAction("billingAddressChanged"),e.billingSwitch&&e.billingSwitch.checked&&doAddonAction("shippingAddressChanged"))}),e.bState&&e.bState.addEventListener("change",function(){doAddonAction("billingAddressChanged")}),e.bCity&&e.bCity.addEventListener("change",function(){doAddonAction("billingAddressChanged")}),e.sCountrySelect&&e.sCountrySelect.addEventListener("change",function(){"0"!==this.value&&doAddonAction("shippingAddressChanged")}),e.sState&&e.sState.addEventListener("change",function(){doAddonAction("shippingAddressChanged")}),e.sCity&&e.sCity.addEventListener("change",function(){doAddonAction("shippingAddressChanged")}),e.billingSwitch&&e.billingSwitch.addEventListener("change",function(){doAddonAction("billingAddressChanged"),doAddonAction("shippingAddressChanged")}),doAddonAction("billingAddressChanged")},e.billingAddressChanged=function(){var t="";e.bState&&(t=e.bState.value);var a="";if(e.bCity&&(a=e.bCity.value),"b"===vars.data.tax_variations_type||!e.billingSwitch||e.billingSwitch.checked)return e.bCountrySelect?void e.doTaxVariations(e.bCountrySelect.value,t,a):void(vars.data.new_bill_addr&&vars.data.new_bill_addr.country&&e.doTaxVariations(vars.data.new_bill_addr.country,vars.data.new_bill_addr.state,vars.data.new_bill_addr.city))},e.shippingAddressChanged=function(){if(!e.billingSwitch)return void(vars.data.new_ship_addr&&vars.data.new_ship_addr.country&&e.doTaxVariations(vars.data.new_ship_addr.country,vars.data.new_ship_addr.state,vars.data.new_ship_addr.city));if("s"===vars.data.tax_variations_type)if(e.billingSwitch.checked)doAddonAction("billingAddressChanged");else{if(!e.sCountrySelect)return;var t="";e.sState&&(t=e.sState.value);var a="";e.sCity&&(a=e.sCity.value),e.doTaxVariations(e.sCountrySelect.value,t,a)}},this.doTaxVariations=function(t,e,a){var r=0,n=0;vars.data.tax_variations.forEach(function(o){switch(o.type){case"0":t&&o.loc===t&&(r+=o.amount,n++);break;case"1":e&&o.loc.toLowerCase()===e.toLowerCase()&&(r+=o.amount,n++);break;case"2":a&&o.loc.toLowerCase()===a.toLowerCase()&&(r+=o.amount,n++)}n>0?(vars.data.tax=r,updateAllAmounts()):vars.data.tax!==vars.data.default_tax&&(vars.data.tax=vars.data.default_tax,updateAllAmounts())})}};!function(){"use strict";function t(t){if(t)d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d,this.buffer8=l;else if(a){var e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var r="input is invalid type",e="object"==typeof window,i=e?window:{};i.JS_MD5_NO_WINDOW&&(e=!1);var s=!e&&"object"==typeof self,h=!i.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;h?i=global:s&&(i=self);var f=!i.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,o="function"==typeof define&&define.amd,a=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,n="0123456789abcdef".split(""),u=[128,32768,8388608,-2147483648],y=[0,8,16,24],c=["hex","array","digest","buffer","arrayBuffer","base64"],p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[],l;if(a){var A=new ArrayBuffer(68);l=new Uint8Array(A),d=new Uint32Array(A)}!i.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!a||!i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var b=function(e){return function(a){return new t(!0).update(a)[e]()}},v=function(){var e=b("hex");h&&(e=w(e)),e.create=function(){return new t},e.update=function(t){return e.create().update(t)};for(var a=0;a<c.length;++a){var r=c[a];e[r]=b(r)}return e},w=function(t){var e=eval("require('crypto')"),i=eval("require('buffer').Buffer"),s=function(a){if("string"==typeof a)return e.createHash("md5").update(a,"utf8").digest("hex");if(null===a||void 0===a)throw r;return a.constructor===ArrayBuffer&&(a=new Uint8Array(a)),Array.isArray(a)||ArrayBuffer.isView(a)||a.constructor===i?e.createHash("md5").update(new i(a)).digest("hex"):t(a)};return s};t.prototype.update=function(t){if(!this.finalized){var e,n=typeof t;if("string"!==n){if("object"!==n)throw r;if(null===t)throw r;if(a&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||a&&ArrayBuffer.isView(t)))throw r;e=!0}for(var o,s,i=0,d=t.length,u=this.blocks,c=this.buffer8;i<d;){if(this.hashed&&(this.hashed=!1,u[0]=u[16],u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),e)if(a)for(s=this.start;i<d&&s<64;++i)c[s++]=t[i];else for(s=this.start;i<d&&s<64;++i)u[s>>2]|=t[i]<<y[3&s++];else if(a)for(s=this.start;i<d&&s<64;++i)(o=t.charCodeAt(i))<128?c[s++]=o:o<2048?(c[s++]=192|o>>6,c[s++]=128|63&o):o<55296||o>=57344?(c[s++]=224|o>>12,c[s++]=128|o>>6&63,c[s++]=128|63&o):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++i)),c[s++]=240|o>>18,c[s++]=128|o>>12&63,c[s++]=128|o>>6&63,c[s++]=128|63&o);else for(s=this.start;i<d&&s<64;++i)(o=t.charCodeAt(i))<128?u[s>>2]|=o<<y[3&s++]:o<2048?(u[s>>2]|=(192|o>>6)<<y[3&s++],u[s>>2]|=(128|63&o)<<y[3&s++]):o<55296||o>=57344?(u[s>>2]|=(224|o>>12)<<y[3&s++],u[s>>2]|=(128|o>>6&63)<<y[3&s++],u[s>>2]|=(128|63&o)<<y[3&s++]):(o=65536+((1023&o)<<10|1023&t.charCodeAt(++i)),u[s>>2]|=(240|o>>18)<<y[3&s++],u[s>>2]|=(128|o>>12&63)<<y[3&s++],u[s>>2]|=(128|o>>6&63)<<y[3&s++],u[s>>2]|=(128|63&o)<<y[3&s++]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[e>>2]|=u[3&e],e>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},t.prototype.hash=function(){var t,e,a,r,n,o,s=this.blocks;this.first?e=((e=((t=((t=s[0]-680876937)<<7|t>>>25)-271733879<<0)^(a=((a=(-271733879^(r=((r=(-1732584194^2004318071&t)+s[1]-117830708)<<12|r>>>20)+t<<0)&(-271733879^t))+s[2]-1126478375)<<17|a>>>15)+r<<0)&(r^t))+s[3]-1316259209)<<22|e>>>10)+a<<0:(t=this.h0,e=this.h1,a=this.h2,e=((e+=((t=((t+=((r=this.h3)^e&(a^r))+s[0]-680876936)<<7|t>>>25)+e<<0)^(a=((a+=(e^(r=((r+=(a^t&(e^a))+s[1]-389564586)<<12|r>>>20)+t<<0)&(t^e))+s[2]+606105819)<<17|a>>>15)+r<<0)&(r^t))+s[3]-1044525330)<<22|e>>>10)+a<<0),e=((e+=((t=((t+=(r^e&(a^r))+s[4]-176418897)<<7|t>>>25)+e<<0)^(a=((a+=(e^(r=((r+=(a^t&(e^a))+s[5]+1200080426)<<12|r>>>20)+t<<0)&(t^e))+s[6]-1473231341)<<17|a>>>15)+r<<0)&(r^t))+s[7]-45705983)<<22|e>>>10)+a<<0,e=((e+=((t=((t+=(r^e&(a^r))+s[8]+1770035416)<<7|t>>>25)+e<<0)^(a=((a+=(e^(r=((r+=(a^t&(e^a))+s[9]-1958414417)<<12|r>>>20)+t<<0)&(t^e))+s[10]-42063)<<17|a>>>15)+r<<0)&(r^t))+s[11]-1990404162)<<22|e>>>10)+a<<0,e=((e+=((t=((t+=(r^e&(a^r))+s[12]+1804603682)<<7|t>>>25)+e<<0)^(a=((a+=(e^(r=((r+=(a^t&(e^a))+s[13]-40341101)<<12|r>>>20)+t<<0)&(t^e))+s[14]-1502002290)<<17|a>>>15)+r<<0)&(r^t))+s[15]+1236535329)<<22|e>>>10)+a<<0,e=((e+=((r=((r+=(e^a&((t=((t+=(a^r&(e^a))+s[1]-165796510)<<5|t>>>27)+e<<0)^e))+s[6]-1069501632)<<9|r>>>23)+t<<0)^t&((a=((a+=(t^e&(r^t))+s[11]+643717713)<<14|a>>>18)+r<<0)^r))+s[0]-373897302)<<20|e>>>12)+a<<0,e=((e+=((r=((r+=(e^a&((t=((t+=(a^r&(e^a))+s[5]-701558691)<<5|t>>>27)+e<<0)^e))+s[10]+38016083)<<9|r>>>23)+t<<0)^t&((a=((a+=(t^e&(r^t))+s[15]-660478335)<<14|a>>>18)+r<<0)^r))+s[4]-405537848)<<20|e>>>12)+a<<0,e=((e+=((r=((r+=(e^a&((t=((t+=(a^r&(e^a))+s[9]+568446438)<<5|t>>>27)+e<<0)^e))+s[14]-1019803690)<<9|r>>>23)+t<<0)^t&((a=((a+=(t^e&(r^t))+s[3]-187363961)<<14|a>>>18)+r<<0)^r))+s[8]+1163531501)<<20|e>>>12)+a<<0,e=((e+=((r=((r+=(e^a&((t=((t+=(a^r&(e^a))+s[13]-1444681467)<<5|t>>>27)+e<<0)^e))+s[2]-51403784)<<9|r>>>23)+t<<0)^t&((a=((a+=(t^e&(r^t))+s[7]+1735328473)<<14|a>>>18)+r<<0)^r))+s[12]-1926607734)<<20|e>>>12)+a<<0,e=((e+=((o=(r=((r+=((n=e^a)^(t=((t+=(n^r)+s[5]-378558)<<4|t>>>28)+e<<0))+s[8]-2022574463)<<11|r>>>21)+t<<0)^t)^(a=((a+=(o^e)+s[11]+1839030562)<<16|a>>>16)+r<<0))+s[14]-35309556)<<23|e>>>9)+a<<0,e=((e+=((o=(r=((r+=((n=e^a)^(t=((t+=(n^r)+s[1]-1530992060)<<4|t>>>28)+e<<0))+s[4]+1272893353)<<11|r>>>21)+t<<0)^t)^(a=((a+=(o^e)+s[7]-155497632)<<16|a>>>16)+r<<0))+s[10]-1094730640)<<23|e>>>9)+a<<0,e=((e+=((o=(r=((r+=((n=e^a)^(t=((t+=(n^r)+s[13]+681279174)<<4|t>>>28)+e<<0))+s[0]-358537222)<<11|r>>>21)+t<<0)^t)^(a=((a+=(o^e)+s[3]-722521979)<<16|a>>>16)+r<<0))+s[6]+76029189)<<23|e>>>9)+a<<0,e=((e+=((o=(r=((r+=((n=e^a)^(t=((t+=(n^r)+s[9]-640364487)<<4|t>>>28)+e<<0))+s[12]-421815835)<<11|r>>>21)+t<<0)^t)^(a=((a+=(o^e)+s[15]+530742520)<<16|a>>>16)+r<<0))+s[2]-995338651)<<23|e>>>9)+a<<0,e=((e+=((r=((r+=(e^((t=((t+=(a^(e|~r))+s[0]-198630844)<<6|t>>>26)+e<<0)|~a))+s[7]+1126891415)<<10|r>>>22)+t<<0)^((a=((a+=(t^(r|~e))+s[14]-1416354905)<<15|a>>>17)+r<<0)|~t))+s[5]-57434055)<<21|e>>>11)+a<<0,e=((e+=((r=((r+=(e^((t=((t+=(a^(e|~r))+s[12]+1700485571)<<6|t>>>26)+e<<0)|~a))+s[3]-1894986606)<<10|r>>>22)+t<<0)^((a=((a+=(t^(r|~e))+s[10]-1051523)<<15|a>>>17)+r<<0)|~t))+s[1]-2054922799)<<21|e>>>11)+a<<0,e=((e+=((r=((r+=(e^((t=((t+=(a^(e|~r))+s[8]+1873313359)<<6|t>>>26)+e<<0)|~a))+s[15]-30611744)<<10|r>>>22)+t<<0)^((a=((a+=(t^(r|~e))+s[6]-1560198380)<<15|a>>>17)+r<<0)|~t))+s[13]+1309151649)<<21|e>>>11)+a<<0,e=((e+=((r=((r+=(e^((t=((t+=(a^(e|~r))+s[4]-145523070)<<6|t>>>26)+e<<0)|~a))+s[11]-1120210379)<<10|r>>>22)+t<<0)^((a=((a+=(t^(r|~e))+s[2]+718787259)<<15|a>>>17)+r<<0)|~t))+s[9]-343485551)<<21|e>>>11)+a<<0,this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=a-1732584194<<0,this.h3=r+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+a<<0,this.h3=this.h3+r<<0)},t.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,a=this.h2,r=this.h3;return n[t>>4&15]+n[15&t]+n[t>>12&15]+n[t>>8&15]+n[t>>20&15]+n[t>>16&15]+n[t>>28&15]+n[t>>24&15]+n[e>>4&15]+n[15&e]+n[e>>12&15]+n[e>>8&15]+n[e>>20&15]+n[e>>16&15]+n[e>>28&15]+n[e>>24&15]+n[a>>4&15]+n[15&a]+n[a>>12&15]+n[a>>8&15]+n[a>>20&15]+n[a>>16&15]+n[a>>28&15]+n[a>>24&15]+n[r>>4&15]+n[15&r]+n[r>>12&15]+n[r>>8&15]+n[r>>20&15]+n[r>>16&15]+n[r>>28&15]+n[r>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,a=this.h2,r=this.h3
;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&a,a>>8&255,a>>16&255,a>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.base64=function(){for(var t,e,a,r="",n=this.array(),o=0;o<15;)t=n[o++],e=n[o++],a=n[o++],r+=p[t>>>2]+p[63&(t<<4|e>>>4)]+p[63&(e<<2|a>>>6)]+p[63&a];return t=n[o],r+=p[t>>>2]+p[t<<4&63]+"=="};var _=v();f?module.exports=_:(i.md5=_,o&&define(function(){return _}))}();var closeBtn=document.getElementById("modal-close-btn");closeBtn.addEventListener("click",function(){void 0!==checkAgeInterval&&(clearInterval(checkAgeInterval),checkAgeInterval=void 0),window.history.replaceState(null,"",null),window.history.go(-1)});const initTime=Date.now();var checkAgeInterval;checkAge(),popstateAttachEvent();var errorCont=document.getElementById("global-error");if(vars.fatal_error)throw showPopup(),new Error(vars.fatal_error);try{var stripe=Stripe(vars.stripe_key,{apiVersion:vars.stripe_api_ver}),elements=stripe.elements({locale:vars.data.checkout_lang})}catch(t){throw showPopup(),errorCont.innerHTML=t,errorCont.style.display="block",document.getElementById("payment-form").style.display="none",new Error(t)}if(vars.data.visitor_token=md5(navigator.userAgent+vars.data.button_key),vars.data.temp=[],vars.data.amount_variable&&"1"!==vars.data.hide_amount_input){var amountInput=document.getElementById("amount"),amountErr=document.getElementById("amount-error");amountInput.addEventListener("change",function(){!1!==(amount=validate_custom_amount())&&(vars.data.item_price=amount,updateAllAmounts())})}if(vars.data.custom_quantity){var quantityInput=document.getElementById("quantity"),quantityErr=document.getElementById("quantity-error");quantityInput.addEventListener("change",function(){quantity=validate_custom_quantity(),!1!==quantity&&(vars.data.quantity=quantity,updateAllAmounts())})}if(vars.data.currency_variable){var currencyInput=document.getElementById("currency");currencyInput.addEventListener("change",function(){vars.data.currency=currencyInput.value||currencyInput.options[currencyInput.selectedIndex],vars.currencyFormat.s=currencyInput.options[currencyInput.selectedIndex].getAttribute("data-asp-curr-sym"),updateAllAmounts()})}if(vars.data.custom_field){var customFieldInput=document.getElementById("asp-custom-field"),customFieldErr=document.getElementById("custom-field-error");customFieldInput&&customFieldInput.addEventListener("change",function(){validate_custom_field()})}if(vars.data.coupons_enabled){var couponBtn=document.getElementById("apply-coupon-btn"),couponRemoveBtn=document.getElementById("remove-coupon-btn"),couponResCont=document.getElementById("coupon-res-cont"),couponInputCont=document.getElementById("coupon-input-cont"),couponInput=document.getElementById("coupon-code"),couponErr=document.getElementById("coupon-err"),couponInfo=document.getElementById("coupon-info");couponInput.addEventListener("keydown",function(t){if(13===t.keyCode)return t.preventDefault(),couponBtn.click(),!1}),couponBtn.addEventListener("click",function(t){if(t.preventDefault(),couponErr.style.display="none",""===couponInput.value)return!1;couponBtn.disabled=!0,smokeScreen(!0);var e="action=asp_pp_check_coupon&product_id="+vars.data.product_id+"&coupon_code="+couponInput.value;new ajaxRequest(vars.ajaxURL,e,function(t){console.log(t);var e=JSON.parse(t.responseText);e.err?(delete vars.data.coupon,console.log(e.err),showFormInputErr(e.err,couponErr,couponInput)):(vars.data.coupon=e,console.log(vars.data.coupon),calcTotal(),couponInfo.innerHTML=vars.data.coupon.code+":  - ","perc"===vars.data.coupon.discount_type?couponInfo.innerHTML=couponInfo.innerHTML+vars.data.coupon.discount+"%":couponInfo.innerHTML=couponInfo.innerHTML+formatMoney(amount_to_cents(vars.data.coupon.discount,vars.data.currency)),vars.data.is_trial&&(couponInfo.innerHTML=couponInfo.innerHTML+vars.str.strforRecurringPayments),couponResCont.style.display="block",couponInputCont.style.display="none",is_full_discount()&&(jQuery('[data-pm-id="def"]').click(),jQuery("#pm-select-cont").hide(),jQuery("#card-cont").hide())),updateAllAmounts(),couponBtn.disabled=!1,smokeScreen(!1)},function(t,e){errorCont.innerHTML=e,errorCont.style.display="block",couponBtn.disabled=!1,smokeScreen(!1)})}),couponRemoveBtn.addEventListener("click",function(){is_full_discount()&&(jQuery("#pm-select-cont").show(),jQuery("#card-cont").show(),vars.data.shipping_orig&&(vars.data.shipping=vars.data.shipping_orig)),delete vars.data.coupon,jQuery("#order-coupon-line").remove(),couponInput.value="",couponResCont.style.display="none",couponInputCont.style.display="block",updateAllAmounts()})}var amount=vars.data.amount,clientSecAmount=0,clientSecCurrency="",style={base:{fontSize:"16px"}},submitBtn=document.getElementById("submit-btn"),piInput=document.getElementById("payment-intent"),cardErrorCont=document.getElementById("card-errors"),form=document.getElementById("payment-form");if(vars.data.tos){var tosInput=document.getElementById("tos"),tosInputErr=document.getElementById("tos-error");tosInput.addEventListener("change",function(){tosInputErr.style.display="none"})}if(!jQuery.isEmptyObject(vars.data.variations)){var varInputs=document.getElementsByClassName("variations-input");vars.data.temp.prePopupDisplayVariationsUpdate=!0;for(var i=0;i<varInputs.length;i++)!function(t){varInputs[t].addEventListener("change",function(){var t=this.getAttribute("data-asp-variations-group-id"),e=this.value;if("INPUT"===this.tagName&&"checkbox"===this.type)return vars.data.variations.applied||(vars.data.variations.applied=[]),vars.data.variations.applied[t]||(vars.data.variations.applied[t]=[]),vars.data.variations.applied[t][e]=this.checked?1:0,void(vars.data.temp.prePopupDisplayVariationsUpdate||updateAllAmounts());0!==Object.getOwnPropertyNames(vars.data.variations).length&&(vars.data.variations.applied||(vars.data.variations.applied=[]),vars.data.variations.applied[t]=e,vars.data.temp.prePopupDisplayVariationsUpdate||updateAllAmounts())}),(varInputs[t].checked||"SELECT"===varInputs[t].tagName)&&triggerEvent(varInputs[t],"change")}(i);vars.data.temp.prePopupDisplayVariationsUpdate=!1,updateAllAmounts()}if(vars.data.billing_address&&vars.data.shipping_address){for(var billshipSwitch=document.getElementById("same-bill-ship-addr"),billaddrCont=document.getElementById("billing-addr-cont"),shipaddrCont=document.getElementById("shipping-addr-cont"),baddrToggles=document.getElementsByClassName("baddr-toggle"),baddrHide=document.getElementsByClassName("baddr-hide"),saddrRequired=document.getElementsByClassName("saddr-required"),itemsArr=[],i=0;i<baddrToggles.length;i++)!function(t){itemsArr.push(baddrToggles[t])}(i);billshipSwitch.addEventListener("change",function(){var t;if(billshipSwitch.checked){for(t=0;t<itemsArr.length;t++)!function(t){attr=itemsArr[t].getAttribute("data-class-save"),itemsArr[t].className=attr}(t);for(t=0;t<baddrHide.length;t++)!function(t){baddrHide[t].style.display="inline-block"}(t);for(t=0;t<saddrRequired.length;t++)!function(t){saddrRequired[t].required=!1}(t);billaddrCont.className="",shipaddrCont.style.display="none"}else{for(t=0;t<itemsArr.length;t++)!function(t){itemsArr[t].setAttribute("data-class-save",itemsArr[t].className),itemsArr[t].className="pure-u-1"}(t);for(t=0;t<baddrHide.length;t++)!function(t){baddrHide[t].style.display="none"}(t);for(t=0;t<saddrRequired.length;t++)!function(t){saddrRequired[t].required=!0}(t);billaddrCont.className="half-width",shipaddrCont.style.display="inline-block"}})}var card=elements.create("card",{style:style,hidePostalCode:!(vars.data.verify_zip&&!vars.data.billing_address)});card.on("ready",function(){submitBtn.disabled=!1}),card.mount("#card-element"),card.addEventListener("change",function(t){errorCont.style.display="none",t.error?cardErrorCont.textContent=t.error.message:cardErrorCont.textContent="",vars.data.cardComplete=t.complete}),jQuery(form).on("submit",function(t){return t.preventDefault(),!!canProceed()&&(is_full_discount()||"def"!==vars.data.currentPM&&vars.data.currentPM||vars.data.cardComplete?(errorCont.style.display="none",submitBtn.disabled=!0,updateAllAmounts(),smokeScreen(!0),doAddonAction("readyToProceed"),void handlePayment()):(card.focus(),!1))}),submitBtn.addEventListener("click",function(){vars.data.isEvent||(vars.data.buttonClicked="")}),vars.data.initShowPopup=!0,vars.data.currentPM="def";try{doAddonAction("init")}catch(t){throw showPopup(),errorCont.innerHTML=t,errorCont.style.display="block",document.getElementById("payment-form").style.display="none",new Error(t)}jQuery("select#currency").on("change",function(){if(!vars.data.addons||!vars.data.currentPM)return!0;vars.data.addons.forEach(function(t){t.supported_curr&&(t.supported_curr.includes(jQuery("select#currency").val())?(jQuery('input[data-pm-id="'+t.name+'"]').attr("disabled",!1).parent().removeClass("pm-disabled"),vars.data.currentPM===t.name&&(submitBtn.disabled=!1,errorCont.style.display="none",vars.data.err_currency_not_supported=!1)):(jQuery('input[data-pm-id="'+t.name+'"]').attr("disabled",!0).parent().addClass("pm-disabled").css("position","relative"),vars.data.currentPM===t.name&&(vars.data.err_currency_not_supported=!0,submitBtn.disabled=!0,errorCont.innerHTML=vars.str.strCurrencyNotSupported,errorCont.style.display="block")))})}),jQuery("select#currency").change(),updateAllAmounts(),vars.data.initShowPopup&&showPopup(),jQuery(".pm-select-btn").click(function(){vars.data.currentPM=jQuery(this).data("pm-id"),jQuery(".pm-select-btn").parent().removeClass("pure-menu-selected"),jQuery(this).parent().addClass("pure-menu-selected"),vars.data.dont_hide_button=!1,doAddonAction("pmSelectClicked");var t=jQuery("#payment-form").find('[data-pm-name][data-pm-name!="'+vars.data.currentPM+'"]');vars.data.dont_hide_button&&(jQuery("#submit-btn-cont").show(),t=jQuery(t.not("#submit-btn-cont"))),t.hide(),jQuery("#payment-form").find('[data-pm-name="'+vars.data.currentPM+'"]').show(),vars.data.err_currency_not_supported&&(vars.data.err_currency_not_supported=!1,submitBtn.disabled=!1,errorCont.style.display="none",vars.data.err_currency_not_supported=!1)});var ajaxRequest=function(t,e,a,r){var n=this;if(this.URL=t,this.reqStr=e,this.doneFunc=a,this.failFunc=r,this.XMLHttpReq=new XMLHttpRequest,!this.XMLHttpReq)return alert("Cannot create an XMLHTTP instance"),!1;n.XMLHttpReq.onreadystatechange=function(){if(n.XMLHttpReq.readyState===XMLHttpRequest.DONE)if(200===n.XMLHttpReq.status)n.doneFunc&&n.doneFunc(n.XMLHttpReq);else{console.log("ajaxRequest failed"),console.log(n.XMLHttpReq);var t="Error occurred: "+n.XMLHttpReq.statusText+"\n";t+="URL: "+n.XMLHttpReq.responseURL+"\n",t+="Code: "+n.XMLHttpReq.status,n.failFunc&&n.failFunc(n.XMLHttpReq,t)}},n.XMLHttpReq.open("POST",n.URL),n.XMLHttpReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.XMLHttpReq.send(e)};jQuery("#threeds-iframe-close-btn").on("click",function(){confirm(vars.str.strAbort3DSecure)&&(console.log("3d Secure check aborted"),jQuery("#asp-3ds-popup").remove(),jQuery("#threeds-iframe-close-btn").hide(),jQuery("#redirect-spinner").hide(),jQuery("#btn-spinner").fadeIn(),vars.data.token_id=null,vars.data.pm_id=null,vars.data.pm_confirmed=!1,submitBtn.disabled=!1,errorCont.innerHTML=vars.str.str3DSecureFailed,errorCont.style.display="block",smokeScreen(!1))});